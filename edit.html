<!DOCTYPE html>
<html>
    <head>
        <title>Obliterating Node's Core - Attic Jack</title>
        
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600,800' rel='stylesheet' type='text/css'>
        <link href="main.css" rel="stylesheet" type="text/css">
        <link href="assets/css/tomorrow.css" rel="stylesheet" type="text/css">
    </head>
    
    <body>
        <div class="masthead">
            <div contenteditable="true" class="title" id="title">Reden<br>[Re]mote [D]evelopment [En]vironment</div>
        </div>
        
        <div class="editor body">
            <div class="full wrapper">
                <div class="content edit" id="content"></div>
                <textarea class="input" id="input"># Blank</textarea>
            </div>
        </div>
        
        <div class="body">
            <div class="wrapper">
                <a class="preview-button" href="#" id="preview">PREVIEW</a>
            </div>
        </div>
        
        <script src="assets/js/highlight.pack.js"></script>
        <script src="assets/js/marked.min.js" type="text/javascript"></script>
        <script src="assets/js/autosize.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            var marking = false
            var ticking = false
            var previewing = false
            
            function update_scroll () {
                ticking = false
                
                if (marking || previewing) {
                    marking = false
                } else {
                    var window_scroll_y = window.scrollY
                    var window_inner_height = window.innerHeight

                    if (window_scroll_y < window_inner_height) {
                        input.style['margin-top'] = '0px'   
                    } else {
                        var content_height = content.scrollHeight
                        var input_height = input.scrollHeight

                        var difference = content_height - input_height

                        if (difference > 0) {
                            var offset = difference * ((window_scroll_y - window_inner_height) / (content_height - window_inner_height))

                            if (offset > 0) {
                                input.style['margin-top'] = offset + 'px'
                            }
                        }
                    }
                }   
            }
            
            function on_scroll () {
                if (!ticking) {
                    requestAnimationFrame(update_scroll)
                }
                
                ticking = true
            }
            
            function toggle_preview () {
                if (previewing) {
                    unpreview()
                } else {
                    preview()
                }
            }
            
            function preview () {
                input.style['display'] = 'none'
                content.className = 'content'
                content.parentElement.className = 'solid wrapper'
                
                previewing = true
            }
            
            function unpreview () {
                input.style['display'] = 'block'
                content.className = 'content edit'
                content.parentElement.className = 'full wrapper'
                
                previewing = false
            }

            window.addEventListener('scroll', on_scroll, false);
            
            marked.setOptions({
                highlight: function (code) {
                    return hljs.highlightAuto(code).value
                }
            })
            
            var content = document.getElementById('content')
            var input = document.getElementById('input')
            var title = document.getElementById('title')
            
            title.spellcheck = false
            title.focus()
            title.blur()
            
            autosize(input)
            
            var preview_button = document.getElementById('preview')
            
            preview_button.onclick = function (e) {
                e.preventDefault()
                
                toggle_preview()
                
                return false
            }
            
            var mark = function() {
                marking = true
                
                content.innerHTML = marked(input.value)
                window.scrollTo(0,document.body.scrollHeight)
            }
            
            mark()
            
            input.oninput = mark
        </script>
    </body>
</html>